<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Mario Bros - Mejorado</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(to bottom, #5c94fc 0%, #5c94fc 70%, #000 70%, #000 100%);
            overflow: hidden;
            font-family: 'Press Start 2P', cursive;
        }

        #gameCanvas {
            display: block;
            margin: 20px auto;
            background: #5c94fc;
            border: 4px solid #000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .game-info {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 14px;
            text-shadow: 2px 2px 0 #000;
            display: flex;
            gap: 40px;
            z-index: 10;
        }

        .controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            color: white;
            font-size: 10px;
            text-align: center;
        }

        .controls h3 {
            margin-bottom: 10px;
            color: #ffd700;
        }

        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 40px;
            border-radius: 20px;
            color: white;
            text-align: center;
            display: none;
            z-index: 100;
        }

        .game-over h2 {
            color: #ff0000;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .game-over button {
            background: #ffd700;
            border: none;
            padding: 15px 30px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 20px;
            font-family: inherit;
        }

        .game-over button:hover {
            background: #ffed4e;
            transform: scale(1.1);
        }

        .nav-buttons-mario {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1001;
            display: flex;
            gap: 10px;
            flex-direction: column;
        }

        .nav-link-mario {
            display: inline-block;
            color: white;
            text-decoration: none;
            padding: 12px 20px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 10px;
            transition: all 0.3s ease;
            border: 3px solid #fff;
            text-align: center;
        }

        .home-link-mario {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);
        }

        .home-link-mario:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 12px 30px rgba(76, 175, 80, 0.6);
        }

        .cube-link {
            background: linear-gradient(135deg, #667eea, #764ba2);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .cube-link:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.6);
        }

        .nav-link-mario:active {
            transform: translateY(-2px) scale(1.02);
        }

        .win-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 200, 0, 0.9);
            padding: 40px;
            border-radius: 20px;
            color: white;
            text-align: center;
            display: none;
            z-index: 100;
        }

        .win-message h2 {
            color: #ffd700;
            margin-bottom: 20px;
            font-size: 32px;
        }
    </style>
</head>
<body>
    <!-- Botones de navegaci√≥n -->
    <div class="nav-buttons-mario">
        <a href="games-menu.html" class="nav-link-mario home-link-mario">
            üè† MEN√ö
        </a>
        <a href="index.html" class="nav-link-mario cube-link">
            üé≤ CUBO RUBIK
        </a>
    </div>

    <div class="game-info">
        <div>PUNTOS: <span id="score">0</span></div>
        <div>MONEDAS: <span id="coins">0</span></div>
        <div>VIDAS: <span id="lives">3</span></div>
        <div>NIVEL: <span id="level">1</span></div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div class="controls">
        <h3>üéÆ CONTROLES</h3>
        <p>‚Üê ‚Üí Mover | ESPACIO Saltar (Doble Salto) | R Reiniciar</p>
    </div>

    <div class="game-over" id="gameOver">
        <h2>GAME OVER</h2>
        <p>Puntuaci√≥n Final: <span id="finalScore">0</span></p>
        <button onclick="restartGame()">JUGAR DE NUEVO</button>
    </div>

    <div class="win-message" id="winMessage">
        <h2>¬°VICTORIA!</h2>
        <p>¬°Has completado el nivel!</p>
        <p>Puntuaci√≥n: <span id="winScore">0</span></p>
        <button onclick="restartGame()">JUGAR DE NUEVO</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        canvas.width = 800;
        canvas.height = 600;

        // Variables del juego
        let score = 0;
        let coins = 0;
        let lives = 3;
        let level = 1;
        let gameRunning = true;
        let keys = {};

        // C√°mara para seguir a Mario
        let camera = {
            x: 0,
            maxX: 2400 // Nivel largo
        };

        // Mario con doble salto
        const mario = {
            x: 100,
            y: 400,
            width: 32,
            height: 32,
            velocityY: 0,
            velocityX: 0,
            speed: 6,
            jumpPower: -16,
            gravity: 0.8,
            onGround: false,
            direction: 1,
            canDoubleJump: false,
            hasDoubleJumped: false
        };

        // Plataformas - Nivel extendido
        const platforms = [
            // Suelo principal
            { x: 0, y: 550, width: 3200, height: 50, color: '#8B4513' },
            
            // Secci√≥n 1 - Inicio
            { x: 200, y: 450, width: 150, height: 20, color: '#228B22' },
            { x: 400, y: 350, width: 150, height: 20, color: '#228B22' },
            { x: 600, y: 250, width: 150, height: 20, color: '#228B22' },
            
            // Secci√≥n 2 - Escaleras
            { x: 900, y: 500, width: 100, height: 20, color: '#228B22' },
            { x: 1050, y: 450, width: 100, height: 20, color: '#228B22' },
            { x: 1200, y: 400, width: 100, height: 20, color: '#228B22' },
            { x: 1350, y: 350, width: 100, height: 20, color: '#228B22' },
            
            // Secci√≥n 3 - Plataformas flotantes
            { x: 1550, y: 450, width: 120, height: 20, color: '#228B22' },
            { x: 1750, y: 400, width: 120, height: 20, color: '#228B22' },
            { x: 1950, y: 350, width: 120, height: 20, color: '#228B22' },
            { x: 2150, y: 300, width: 120, height: 20, color: '#228B22' },
            
            // Secci√≥n 4 - Desaf√≠o final
            { x: 2400, y: 450, width: 100, height: 20, color: '#228B22' },
            { x: 2600, y: 350, width: 100, height: 20, color: '#228B22' },
            { x: 2800, y: 250, width: 150, height: 20, color: '#228B22' },
            
            // Plataforma final (meta)
            { x: 3000, y: 450, width: 200, height: 20, color: '#FFD700', isFinal: true }
        ];

        // Monedas distribuidas
        let coinsList = [
            // Secci√≥n 1
            { x: 250, y: 400, collected: false },
            { x: 450, y: 300, collected: false },
            { x: 650, y: 200, collected: false },
            
            // Secci√≥n 2
            { x: 950, y: 450, collected: false },
            { x: 1100, y: 400, collected: false },
            { x: 1250, y: 350, collected: false },
            { x: 1400, y: 300, collected: false },
            
            // Secci√≥n 3
            { x: 1600, y: 400, collected: false },
            { x: 1800, y: 350, collected: false },
            { x: 2000, y: 300, collected: false },
            { x: 2200, y: 250, collected: false },
            
            // Secci√≥n 4
            { x: 2450, y: 400, collected: false },
            { x: 2650, y: 300, collected: false },
            { x: 2850, y: 200, collected: false },
            
            // Monedas bonus
            { x: 1500, y: 250, collected: false },
            { x: 2300, y: 150, collected: false }
        ];

        // Enemigos m√°s dif√≠ciles
        let enemies = [
            // Secci√≥n 1
            { x: 300, y: 520, width: 30, height: 30, velocityX: 2, color: '#8B0000', minX: 200, maxX: 500 },
            { x: 500, y: 520, width: 30, height: 30, velocityX: -2, color: '#8B0000', minX: 400, maxX: 700 },
            
            // Secci√≥n 2
            { x: 1000, y: 520, width: 30, height: 30, velocityX: 3, color: '#8B0000', minX: 900, maxX: 1300 },
            { x: 1300, y: 520, width: 30, height: 30, velocityX: -3, color: '#FF0000', minX: 1200, maxX: 1500 },
            
            // Secci√≥n 3
            { x: 1700, y: 520, width: 30, height: 30, velocityX: 2.5, color: '#8B0000', minX: 1600, maxX: 2000 },
            { x: 2000, y: 520, width: 30, height: 30, velocityX: -2.5, color: '#FF0000', minX: 1900, maxX: 2200 },
            
            // Secci√≥n 4 - Enemigos r√°pidos
            { x: 2500, y: 520, width: 30, height: 30, velocityX: 4, color: '#FF0000', minX: 2400, maxX: 2700 },
            { x: 2700, y: 520, width: 30, height: 30, velocityX: -4, color: '#FF0000', minX: 2600, maxX: 2900 }
        ];

        // Controles con doble salto
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;

            if (e.key === ' ') {
                if (mario.onGround) {
                    mario.velocityY = mario.jumpPower;
                    mario.onGround = false;
                    mario.canDoubleJump = true;
                    mario.hasDoubleJumped = false;
                } else if (mario.canDoubleJump && !mario.hasDoubleJumped) {
                    mario.velocityY = mario.jumpPower * 0.8;
                    mario.hasDoubleJumped = true;
                    mario.canDoubleJump = false;
                }
            }

            if (e.key === 'r' || e.key === 'R') {
                restartGame();
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        // Actualizar c√°mara
        function updateCamera() {
            camera.x = mario.x - canvas.width / 3;
            if (camera.x < 0) camera.x = 0;
            if (camera.x > camera.maxX) camera.x = camera.maxX;
        }

        // Dibujar Mario
        function drawMario() {
            const screenX = mario.x - camera.x;
            
            ctx.fillStyle = '#FF0000';
            ctx.fillRect(screenX, mario.y, mario.width, mario.height);
            
            ctx.fillStyle = '#FF0000';
            ctx.fillRect(screenX + 4, mario.y - 8, mario.width - 8, 8);
            
            ctx.fillStyle = '#FFD700';
            ctx.fillRect(screenX + 8, mario.y + 8, mario.width - 16, 12);
            
            ctx.fillStyle = '#000';
            if (mario.direction === 1) {
                ctx.fillRect(screenX + 18, mario.y + 10, 4, 4);
            } else {
                ctx.fillRect(screenX + 10, mario.y + 10, 4, 4);
            }
            
            ctx.fillStyle = '#0000FF';
            ctx.fillRect(screenX + 6, mario.y + 20, mario.width - 12, 12);
        }

        // Dibujar plataformas
        function drawPlatforms() {
            platforms.forEach(platform => {
                const screenX = platform.x - camera.x;
                if (screenX + platform.width > 0 && screenX < canvas.width) {
                    ctx.fillStyle = platform.color;
                    ctx.fillRect(screenX, platform.y, platform.width, platform.height);
                    
                    ctx.fillStyle = platform.isFinal ? '#FFF' : '#90EE90';
                    ctx.fillRect(screenX, platform.y, platform.width, 3);
                }
            });
        }

        // Dibujar monedas
        function drawCoins() {
            coinsList.forEach(coin => {
                if (!coin.collected) {
                    const screenX = coin.x - camera.x;
                    if (screenX > -20 && screenX < canvas.width + 20) {
                        ctx.fillStyle = '#FFD700';
                        ctx.beginPath();
                        ctx.arc(screenX, coin.y, 10, 0, Math.PI * 2);
                        ctx.fill();
                        
                        ctx.fillStyle = '#FFED4E';
                        ctx.beginPath();
                        ctx.arc(screenX - 3, coin.y - 3, 4, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
            });
        }

        // Dibujar enemigos
        function drawEnemies() {
            enemies.forEach(enemy => {
                const screenX = enemy.x - camera.x;
                if (screenX + enemy.width > 0 && screenX < canvas.width) {
                    ctx.fillStyle = enemy.color;
                    ctx.fillRect(screenX, enemy.y, enemy.width, enemy.height);
                    
                    ctx.fillStyle = '#FFF';
                    ctx.fillRect(screenX + 5, enemy.y + 8, 8, 8);
                    ctx.fillRect(screenX + 17, enemy.y + 8, 8, 8);
                    
                    ctx.fillStyle = '#000';
                    ctx.fillRect(screenX + 8, enemy.y + 11, 3, 3);
                    ctx.fillRect(screenX + 20, enemy.y + 11, 3, 3);
                }
            });
        }

        // Actualizar Mario
        function updateMario() {
            if (keys['ArrowLeft']) {
                mario.velocityX = -mario.speed;
                mario.direction = -1;
            } else if (keys['ArrowRight']) {
                mario.velocityX = mario.speed;
                mario.direction = 1;
            } else {
                mario.velocityX = 0;
            }

            mario.x += mario.velocityX;
            
            if (mario.x < 0) mario.x = 0;
            if (mario.x + mario.width > 3200) mario.x = 3200 - mario.width;

            mario.velocityY += mario.gravity;
            mario.y += mario.velocityY;

            mario.onGround = false;
            platforms.forEach(platform => {
                if (mario.x < platform.x + platform.width &&
                    mario.x + mario.width > platform.x &&
                    mario.y + mario.height > platform.y &&
                    mario.y + mario.height < platform.y + platform.height &&
                    mario.velocityY > 0) {
                    
                    mario.y = platform.y - mario.height;
                    mario.velocityY = 0;
                    mario.onGround = true;
                    mario.canDoubleJump = false;
                    mario.hasDoubleJumped = false;
                    
                    // Verificar si lleg√≥ a la meta
                    if (platform.isFinal) {
                        winGame();
                    }
                }
            });

            if (mario.y > canvas.height) {
                loseLife();
            }
        }

        // Actualizar enemigos
        function updateEnemies() {
            enemies.forEach(enemy => {
                enemy.x += enemy.velocityX;
                
                if (enemy.x <= enemy.minX || enemy.x + enemy.width >= enemy.maxX) {
                    enemy.velocityX *= -1;
                }
                
                if (mario.x < enemy.x + enemy.width &&
                    mario.x + mario.width > enemy.x &&
                    mario.y < enemy.y + enemy.height &&
                    mario.y + mario.height > enemy.y) {
                    
                    if (mario.velocityY > 0 && mario.y + mario.height - 10 < enemy.y) {
                        enemy.x = -100;
                        mario.velocityY = -10;
                        score += 100;
                    } else {
                        loseLife();
                    }
                }
            });
        }

        // Recolectar monedas
        function collectCoins() {
            coinsList.forEach(coin => {
                if (!coin.collected) {
                    const dist = Math.sqrt(
                        Math.pow(mario.x + mario.width/2 - coin.x, 2) +
                        Math.pow(mario.y + mario.height/2 - coin.y, 2)
                    );
                    
                    if (dist < 20) {
                        coin.collected = true;
                        coins++;
                        score += 50;
                    }
                }
            });
        }

        // Perder vida
        function loseLife() {
            lives--;
            if (lives <= 0) {
                gameOver();
            } else {
                mario.x = 100;
                mario.y = 400;
                mario.velocityY = 0;
                camera.x = 0;
            }
        }

        // Game Over
        function gameOver() {
            gameRunning = false;
            document.getElementById('finalScore').textContent = score;
            document.getElementById('gameOver').style.display = 'block';
        }

        // Ganar
        function winGame() {
            gameRunning = false;
            document.getElementById('winScore').textContent = score;
            document.getElementById('winMessage').style.display = 'block';
        }

        // Reiniciar
        function restartGame() {
            score = 0;
            coins = 0;
            lives = 3;
            gameRunning = true;
            mario.x = 100;
            mario.y = 400;
            mario.velocityY = 0;
            camera.x = 0;
            
            coinsList.forEach(coin => coin.collected = false);
            enemies = [
                { x: 300, y: 520, width: 30, height: 30, velocityX: 2, color: '#8B0000', minX: 200, maxX: 500 },
                { x: 500, y: 520, width: 30, height: 30, velocityX: -2, color: '#8B0000', minX: 400, maxX: 700 },
                { x: 1000, y: 520, width: 30, height: 30, velocityX: 3, color: '#8B0000', minX: 900, maxX: 1300 },
                { x: 1300, y: 520, width: 30, height: 30, velocityX: -3, color: '#FF0000', minX: 1200, maxX: 1500 },
                { x: 1700, y: 520, width: 30, height: 30, velocityX: 2.5, color: '#8B0000', minX: 1600, maxX: 2000 },
                { x: 2000, y: 520, width: 30, height: 30, velocityX: -2.5, color: '#FF0000', minX: 1900, maxX: 2200 },
                { x: 2500, y: 520, width: 30, height: 30, velocityX: 4, color: '#FF0000', minX: 2400, maxX: 2700 },
                { x: 2700, y: 520, width: 30, height: 30, velocityX: -4, color: '#FF0000', minX: 2600, maxX: 2900 }
            ];
            
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('winMessage').style.display = 'none';
        }

        // Actualizar UI
        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('coins').textContent = coins;
            document.getElementById('lives').textContent = lives;
            document.getElementById('level').textContent = level;
        }

        // Dibujar fondo
        function drawBackground() {
            ctx.fillStyle = '#5c94fc';
            ctx.fillRect(0, 0, canvas.width, canvas.height * 0.7);
            
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(0, canvas.height * 0.7, canvas.width, canvas.height * 0.3);
            
            // Nubes que se mueven con la c√°mara
            const cloud1X = 150 - (camera.x * 0.3);
            const cloud2X = 550 - (camera.x * 0.3);
            
            ctx.fillStyle = '#FFF';
            ctx.beginPath();
            ctx.arc(cloud1X, 80, 30, 0, Math.PI * 2);
            ctx.arc(cloud1X + 30, 80, 35, 0, Math.PI * 2);
            ctx.arc(cloud1X + 60, 80, 30, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(cloud2X, 120, 25, 0, Math.PI * 2);
            ctx.arc(cloud2X + 25, 120, 30, 0, Math.PI * 2);
            ctx.arc(cloud2X + 50, 120, 25, 0, Math.PI * 2);
            ctx.fill();
        }

        // Loop principal
        function gameLoop() {
            if (gameRunning) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                updateCamera();
                drawBackground();
                drawPlatforms();
                drawCoins();
                drawEnemies();
                drawMario();
                
                updateMario();
                updateEnemies();
                collectCoins();
                updateUI();
            }
            
            requestAnimationFrame(gameLoop);
        }

        gameLoop();
    </script>
</body>
</html>